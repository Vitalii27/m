var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(i,a){try{var o=t[i](a),s=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(s).then(function(e){return n("next",e)},function(e){return n("throw",e)});e(s)}("next")})}}var router=new VueRouter({mode:"history"}),formatedAxios=axios.create({paramsSerializer:function(e){return Qs.stringify(e,{arrayFormat:"repeat"})}}),orderFlag=!1,f=[!0,!1],app=new Vue({router:router,el:"#app",watch:{"$route.query":{deep:!0,handler:function(){f[0]?this.getData():f[0]=!0}},priceRange:{handler:function(){f[1]?this.pushPriceRange():f[1]=!0}},"$route.query.search":{deep:!0,handler:function(){this.getCategories()}},curPage:{deep:!0,handler:function(){if(this.curPage>1){var e=document.getElementById("app").offsetTop;window.scrollTo(0,e)}}},compareProducts:{deep:!0,handler:function(){localStorage.setItem("compareProductsSearch",JSON.stringify(this.compareProducts))}}},data:function(){return{prevpage:null,nextpage:null,currentPage:null,pageNumbers:[],totalPages:0,totalItems:0,currentTotalItems:0,perPage:20,dataFilterParams:{},selectedItems:{},search:"",searchWord:"",products:[],categories:[],currentCategory:"",chosenSortOrder:"",sortData:[],pageType:"",api:"",loading:!1,initMinRange:0,initMaxRange:99999,hasPriceRange:!1,priceRange:[],compareUrl:"",compareProducts:[],isHidePopup:!1}},mounted:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getCategories();case 2:return t.next=4,e.getFilterParams();case 4:return t.next=6,e.getData();case 6:setTimeout(function(){e.syncFilter()}),localStorage.getItem("compareProductsSearch")&&(e.compareProducts=JSON.parse(localStorage.getItem("compareProductsSearch"))),document.getElementById("app").style.opacity=1;case 9:case"end":return t.stop()}},t,e)}))()},computed:{totalPageCount:function(){return parseInt(this.totalPages)},isPagination:function(){return this.totalPages>1},queryWithoutPage:function(){return _.omit(this.$route.query,"page")},filteredQuery:function(){return _.omit(this.$route.query,["page","search","path","orderBy"])},showFirst:function(){return this.currentPage>=5},showFirstDots:function(){return this.currentPage>=5},showLast:function(){return this.curPage<=this.totalPageCount-4},showLastDots:function(){return this.curPage<=this.totalPageCount-4},curPage:function(){return this.$route.query.page?this.$route.query.page:1},omitFilterParams:function(){return _.omit(this.dataFilterParams,["orderby","attributes_names"])},compareLink:function(){var e=[];return _.map(this.compareProducts,function(t){e.push(t.uuid)}),this.compareUrl+"?products="+e.join(",")},isActiveCompare:function(){return this.compareProducts.length>0},productsWord:function(){return this.compareProducts.length>1?"products":"product"},compareProductsLength:function(){return this.compareProducts.length?this.compareProducts.length:0}},methods:{pushFilterQuery:function(e){var t,r=this.selectedItems[e];r=r.length>0?r:void 0,this.$router.push({query:_extends({},this.$route.query,(t={},_defineProperty(t,e,r),_defineProperty(t,"page",void 0),t))})},clearFilterQuery:function(e){var t;if(this.selectedItems[e].length<=0)return!1;_.isArray(this.selectedItems[e])?this.selectedItems[e]=[]:this.selectedItems[e]="",this.$router.push({query:_extends({},this.$route.query,(t={},_defineProperty(t,e,void 0),_defineProperty(t,"page",void 0),t))})},pushSortQuery:function(){this.$router.push({query:_extends({},this.$route.query,{orderBy:this.chosenSortOrder,page:void 0})})},pushPriceRange:_.debounce(function(){return this.$route.query.price!==this.priceRange&&this.$router.push({query:_extends({},this.$route.query,{price:this.priceRange,page:void 0})})},300),pushSearch:function(){return!!this.notEmpty(this.search)&&(this.search!==_.get(this.$route.query,"search","")&&(this.dataFilterParams={},void this.$router.push({query:{search:this.notEmpty(this.search)?this.search:void 0,page:void 0}})))},pushCategory:function(e){var t=this;this.$router.push({query:{search:this.$route.query.search,orderBy:this.$route.query.orderBy,path:this.notEmpty(e)?e:void 0,page:void 0}}).then(function(){t.getFilterParams()}),this.currentCategory=e},getData:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=_extends({},e.$route.query),_.get(r,"search",!1)){t.next=3;break}return t.abrupt("return",!1);case 3:return!_.isEmpty(r)&&_.get(e.$route,"query.search",!1)&&(r.page||(r.page=1),!r.orderBy&&e.sortData.length>0&&(r.orderBy=_.get(e.sortData[0],"value",void 0)),_.isEmpty(e.search)&&_.get(r,"search",!1)&&(e.search=r.search)),r.offset=r.page*e.perPage-e.perPage,r.offset=r.offset?r.offset:0,delete r.page,e.loading=!0,t.prev=8,t.next=11,formatedAxios.get(e.api+".rest/productSearch/v1/search",{params:_extends({limit:e.perPage?e.perPage:void 0},r)});case 11:n=t.sent,i=n.data,a=n.headers,e.totalItems=Number(_.get(a,"x_search_total",0)),e.perPage=Number(_.get(a,"x_search_limit",e.perPage)),e.totalPages=Math.ceil(e.totalItems/e.perPage),_.get(a,"x_price_min",!1)&&_.get(a,"x_price_max",!1)?(e.initMinRange=Number(a.x_price_min),e.initMaxRange=Number(a.x_price_max),$(".slider-range").slider("option","min",e.initMinRange),$(".slider-range").slider("option","max",e.initMaxRange),e.hasPriceRange=!0):e.hasPriceRange=!1,e.products=i,e.currentTotalItems=i.length,e.notEmpty(e.search)&&(e.searchWord=e.search),e.setPageNumbers(),i.length>0&&!document.getElementsByClassName("jcf-select")[0]&&(e.notEmpty(e.$route.query.orderBy)?e.chosenSortOrder=e.$route.query.orderBy:e.chosenSortOrder=e.sortData[0].value,setTimeout(function(){jcf.destroyAll(),jcf.replaceAll()})),t.next=29;break;case 25:t.prev=25,t.t0=t.catch(8),alert(t.t0),e.$router.push({query:{}});case 29:return t.prev=29,e.loading=!1,t.finish(29);case 32:case"end":return t.stop()}},t,e,[[8,25,29,32]])}))()},getCategories:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(_.get(e.$route.query,"search",!1)&&e.$route.query.search!==e.searchWord){t.next=2;break}return t.abrupt("return",!1);case 2:return t.prev=2,t.next=5,formatedAxios.get(e.api+".rest/productSearch/v1/categories");case 5:r=t.sent,n=r.data,e.categories=n,t.next=13;break;case 10:t.prev=10,t.t0=t.catch(2),alert(t.t0);case 13:case"end":return t.stop()}},t,e,[[2,10]])}))()},getFilterParams:function(){var e=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$route.query.path){t.next=2;break}return t.abrupt("return",!1);case 2:return t.prev=2,t.delegateYield(regeneratorRuntime.mark(function t(){var r,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,formatedAxios.get(e.api+".rest/productSearch/v1/filters",{params:{path:e.$route.query.path}});case 2:r=t.sent,n=r.data,i={},_.map(n,function(e){i=e.values.length<=1||"OR"!==e.type?_extends({},i,_defineProperty({},e.uuid,[])):_extends({},i,_defineProperty({},e.uuid,""))}),e.selectedItems=i,e.dataFilterParams=n;case 8:case"end":return t.stop()}},t,e)})(),"t0",4);case 4:t.next=9;break;case 6:t.prev=6,t.t1=t.catch(2),alert(t.t1);case 9:case"end":return t.stop()}},t,e,[[2,6]])}))()},setOrder:function(e){orderFlag||(this.sortData=e,orderFlag=!0)},setApi:function(e){return this.api=e||window.location.origin},notEmpty:function(e){return!_.isEmpty(e)},compileQueries:function(e){return _extends({},this.queryWithoutPage,e)},setPages:function(e,t){this.prevpage=e>1?e-1:null,this.nextpage=t?e<t?parseInt(e)+1:null:e?parseInt(e)+1:2;var r=6,n=2;(this.showFirst||this.showLast)&&(r=5),this.showFirst&&this.showLast&&(r=4,this.currentPage<this.totalPageCount/2&&(n=1));for(var i=0;i<r;i++){var a=parseInt(e)-n+i;a>0&&a<=t&&this.pageNumbers.push(a)}},setPageNumbers:function(){this.prevpage=null,this.nextpage=null,this.currentPage=null,this.pageNumbers=[];var e=this.curPage;this.currentPage=e,this.setPages(e,this.totalPageCount)},hasColor:function(e){var t=!0;return _.map(e,function(e){_.isEmpty(e.color)&&(t=!1)}),t},colorStyle:function(e){return{backgroundColor:""+e.color,border:"1px solid "+("#ffffff"!==e.color&&"#fff"!==e.color?"transparent":"gray")}},syncFilter:function(){var e=this;if(this.search=_.get(this.$route,"query.search",!1)?this.$route.query.search:void 0,this.priceRange=[this.initMinRange,this.initMaxRange],_.get(this.$route.query,"price",!1)){this.priceRange=[_.isEmpty(e.$route.query.price[0])?e.initMinRange:Number(e.$route.query.price[0])<e.initMinRange?e.initMinRange:!_.isEmpty(e.$route.query.price[1])&&Number(e.$route.query.price[1])<Number(e.$route.query.price[0])?_.get(e.$route.query,"price[1]"):e.$route.query.price[0],_.isEmpty(e.$route.query.price[1])?e.initMaxRange:Number(e.$route.query.price[1])>e.initMaxRange?e.initMaxRange:e.$route.query.price[1]&&!_.isEmpty(e.$route.query.price[0])&&Number(e.$route.query.price[0])>Number(e.$route.query.price[1])?e.$route.query.price[0]:e.$route.query.price[1]]}this.initJquerySliderRange(),this.setRangeJquerySlider(),this.notEmpty(this.filteredQuery)&&_.map(this.filteredQuery,function(t,r){_.isArray(e.selectedItems[r])?e.selectedItems[r]=t.split(","):e.selectedItems[r]=t}),this.notEmpty(this.$route.query.orderBy)?this.chosenSortOrder=this.$route.query.orderBy:this.chosenSortOrder=this.sortData[0].value,setTimeout(function(){jcf.destroyAll(),jcf.replaceAll()},1e3)},setRangeJquerySlider:function(){$(".slider-range").slider("option","values",this.priceRange)},initJquerySliderRange:function(){var e=this;$(".slider-range").slider({range:!0,min:this.initMinRange,max:this.initMaxRange,step:.01,values:this.priceRange,slide:function(t,r){e.priceRange=r.values}})},filterType:function(e){return e.values.length<=1||"OR"!==e.type?"checkbox":"radio"},isActiveCategory:function(e){return this.$route.query.path===e},getFilterName:function(e){return e.name?e.name:"Filter"},addRatingWidth:function(e,t){var r=Number(e),n=Math.floor(r);return t<n?"100%":t===n?100*function(e,t){if(e>=1)return Number((e%t).toFixed(1));return e}(r,n)+"%":0},removeCompareProduct:function(e){var t=_.findIndex(this.compareProducts,{uuid:e});t>=0&&this.$delete(this.compareProducts,t)},clearAllCompareProducts:function(){this.compareProducts=[]},setCompareLink:function(e){return e?this.compareUrl=e:this.api=window.location.origin+"compare-products.html"},compareMax:function(e){return this.compareProducts.length>=4&&void 0===_.find(this.compareProducts,{uuid:e})},hideShowComparePopup:function(){this.isHidePopup=!this.isHidePopup}}});